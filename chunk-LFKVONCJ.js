import{b as d}from"./chunk-GYUCNXMX.js";import{a as u,b as h,d as c,e as l,u as L}from"./chunk-K6Z3VPJB.js";import{U as g,_ as a,f as n,ua as i,ya as o}from"./chunk-BAJSPIZF.js";var I=(()=>{class s{constructor(){this.router=a(L),this.translate=a(d),this.location=a(h),this.platformId=a(o),this.document=a(u),this.userLanguage=i(""),this.askUserToSwitch=!1,this.supportedLanguages=["de","en"],this.oldLanguage="",this.translate.addLangs(this.supportedLanguages),this.translate.setDefaultLang("en"),this.userAgendLanguage=this.getLanguageFromUserAgent(),this.userLanguage.set(this.userAgendLanguage),this.loadLanguageFromLocalStorage()}loadLanguageFromLocalStorage(){if(!c(this.platformId))return;this.askUserToSwitch=!0;let t=localStorage.getItem("Custom Language");t&&(this.userLanguage.set(t),this.askUserToSwitch=!1)}updateLanguage(t){return n(this,null,function*(){t||(t=this.userLanguage()),this.userLanguage.set(yield this.replaceUnsupportedLangauge(t)),this.document.documentElement.lang=this.userLanguage();let e=this.askUserToSwitch&&this.userLanguage()!=this.userAgendLanguage;this.askUserToSwitch=e,this.translate.use(this.userLanguage())})}replaceUnsupportedLangauge(t){return n(this,null,function*(){if(!this.supportedLanguages.includes(t)){let e=this.userAgendLanguage,r=this.router.url.replace(t,e);return console.log("Language "+t+" not supported. Switching to "+e),yield this.router.navigateByUrl(r),e}return t})}switchUserLanguage(t){return n(this,null,function*(){this.oldLanguage=this.userLanguage(),this.userLanguage.set(t);let e=this.location.path().includes(this.oldLanguage),r=this.location.path().replace(this.oldLanguage,t);console.log("Switching language from "+this.oldLanguage+" to "+t+" newURL: "+r),e||(yield this.updateLanguage(t)),yield this.router.navigateByUrl(r),localStorage.setItem("Custom Language",this.userLanguage().toString()),this.askUserToSwitch=!1})}getLanguageFromUserAgent(){if(l(this.platformId))return"en";let t=navigator.language||navigator.languages&&navigator.languages[0];return console.log(`Detected user language: ${t}`),t?t.split("-")[0]:"en"}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=g({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{I as a};
