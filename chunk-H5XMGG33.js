import{a as D}from"./chunk-OWZYVNKW.js";import{c as C,g as b,h as $}from"./chunk-5HCMFROV.js";import{O as x,T as g,n as H,qa as I,sa as T}from"./chunk-C7F2T4HE.js";var k=class{constructor(s){this.keywords=[],this.commentsDisabled=!1,this.hasCodePen=!1,this.hideInFeed=!1,this.fileName=s}initFromObject(s,S){Object.assign(this,s),s.date&&(this.date=new Date(s.date)),this.date&&(this.localDateString=new Date(this.date).toLocaleDateString(S))}};var h=class{constructor(s,S,e,t){this.postMeta=new k(S),this.postMeta.initFromObject(s,e),this.postContent=t}};var q=(()=>{let s=class s{constructor(){this.http=g($),this.transferState=g(T),this.languageS=g(D),this.platformId=g(I),this.baseUrl="/"}async getPost(e){let t=this.loadPostFromTransferState(e);console.log(t);let o=this.languageS.userLanguage();return t||(t=await this.loadFromMarkdownFile(e,o)),t?(this.savePostTransferState(e,t),t):null}savePostTransferState(e,t){if(C(this.platformId))return;let o="post-"+this.languageS.userLanguage()+"-"+e;this.transferState.set(o,t)}loadPostFromTransferState(e){if(!C(this.platformId))return null;let t="post-"+this.languageS.userLanguage()+"-"+e,o=this.transferState.get(t,null);if(!o)return null;this.transferState.remove(t);let a=new h(o?.postMeta??{},e,this.languageS.userLanguage());return a.postContent=o?.postContent,a}async loadFromMarkdownFile(e,t){console.log(`Loading post ${e} in ${t} from markdown file`);let o=`${this.baseUrl}posts/${t}/${e}.md`,a;try{if([a,this.markdownHelper,this.highlightHelper]=await Promise.all([H(this.http.get(o,{responseType:"text",observe:"response",headers:{Accept:"text/plain"},transferCache:{includeHeaders:["Content-Type"]}})),import("./chunk-I43WBGWC.js").then(c=>c.MarkdownHelper),import("./chunk-OY3XJTR7.js").then(c=>c.HighlightHelper)]),a.headers.get("Content-Type")?.includes("text/html"))return null;let n=a.body,m=this.markdownHelper.extractYamlHeader(n),u=this.markdownHelper.extractBody(n),y=/```(\S*)\s([\s\S]*?)```/g,F=u.replace(y,(c,i,f)=>{let L=f.trim(),M=this.highlightHelper.highlightElement(L,i);return`<pre><code class="language-${i}">${M}</code></pre>`}),P=await this.markdownHelper.parseMarkdown(F);return new h(m,e,this.languageS.userLanguage(),P)}catch(n){return console.error(n),n instanceof b&&n.status===404&&t!=="en"?this.loadFromMarkdownFile(e,"en"):null}}async loadPostList(e,t=1,o=10,a="desc",n="date",m=[],u=""){let y=`${this.baseUrl}posts/posts.${e}.json`,F=await H(this.http.get(y,{responseType:"text"})),c=JSON.parse(F).filter(r=>!r.hideInFeed&&(m.length===0||m.some(w=>r.keywords.some(l=>l.includes(w))))&&(u===""||r.title&&r.title.includes(u))),i=[];for(let r of c)i.push(new h(r,r.fileName,this.languageS.userLanguage()));i.sort((r,w)=>{let l,d;return n==="date"?(l=new Date(r.postMeta?.date??0).getTime(),d=new Date(w.postMeta?.date??0).getTime()):n==="title"?(l=r.postMeta?.title?.toLowerCase()??"",d=w.postMeta?.title?.toLowerCase()??""):(l="",d=""),l<d?a==="asc"?-1:1:l>d?a==="asc"?1:-1:0});let f=(t-1)*o,L=i.slice(f,f+o),M=Math.ceil(i.length/o);return{posts:L,totalPages:M}}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=x({token:s,factory:s.\u0275fac,providedIn:"root"});let p=s;return p})();export{q as a};
