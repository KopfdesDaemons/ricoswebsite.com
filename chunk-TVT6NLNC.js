import{a as p}from"./chunk-MRP2LEQ3.js";import{b as d}from"./chunk-KK2A4E5N.js";import{p as m}from"./chunk-AHQAFESL.js";import{e as l,k as o,l as L}from"./chunk-LOFVFHXP.js";import{$b as c,P as r,U as a,da as i,ka as n,ma as u,va as h}from"./chunk-5C5RMVSW.js";var k=(()=>{class s{constructor(){this.router=a(m),this.translate=a(d),this.location=a(l),this.platformId=a(h),this.document=a(i),this.consentS=a(p),this.customLanguageConsent=c(()=>this.consentS.possibleConsents.find(e=>e.name==="Custom Language Consent")?.consent()??!1,{}),this.userLanguage=n("",{}),this.askUserToSwitch=n(!0,{}),this.supportedLanguages=["de","en"],this.oldLanguage="",this.translate.addLangs(this.supportedLanguages),this.translate.setDefaultLang("en"),this.userAgentLanguage=this.getUserAgentLanguage(),this.userLanguage.set(this.userAgentLanguage),this.loadLanguageFromLocalStorage(),u(()=>{if(!this.customLanguageConsent()){if(!o(this.platformId))return;localStorage.removeItem("Custom Language")}})}loadLanguageFromLocalStorage(){if(!o(this.platformId))return;let e=localStorage.getItem("Custom Language");e&&(this.userLanguage.set(e),this.askUserToSwitch.set(!1))}async updateLanguage(e){e=e||this.userLanguage(),this.userLanguage.set(await this.replaceUnsupportedLangauge(e)),this.document.documentElement.lang=this.userLanguage(),this.askUserToSwitch.set(this.askUserToSwitch()&&this.userLanguage()!=this.userAgentLanguage),this.translate.use(this.userLanguage())}async replaceUnsupportedLangauge(e){if(!this.supportedLanguages.includes(e)){let t=this.userAgentLanguage,g=this.router.url.replace(e,t);return console.log(`Language ${e} not supported. Switching to ${t}`),await this.router.navigateByUrl(g),t}return e}async switchUserLanguage(e){this.oldLanguage=this.userLanguage(),this.userLanguage.set(e);let t=this.location.path().replace(this.oldLanguage,e);console.log(`Switching language from ${this.oldLanguage} to ${e}. New URL: ${t}`),this.location.path().includes(this.oldLanguage)||await this.updateLanguage(e),await this.router.navigateByUrl(t),localStorage.setItem("Custom Language",this.userLanguage().toString()),this.askUserToSwitch.set(!1),this.consentS.giveConsent("Custom Language Consent")}getUserAgentLanguage(){if(L(this.platformId))return"en";let e=navigator.language||navigator.languages&&navigator.languages[0];return console.log(`Detected user language: ${e}`),e?e.split("-")[0]:"en"}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=r({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{k as a};
